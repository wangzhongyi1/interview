# vue3设计目标是什么？做了哪些优化？

## vue3设计目标

一句话：更小、更快、更友好

- 更小：指源码体积小
- 更快：项目运行速度更快
- 更友好
    + typescript 支持更友好
    + API设计一致性
    + 提高自身可维护性
    + 开放更多底层API

## vue3中做了哪些优化

总结而言就是三方面都优化：源码、性能、语法API

- 首先说源码方面优化

vue3整个源码使用 monorepo 都方式来管理，将功能不同的模块拆分到 packages 目录下的子目录中

模块拆分更细化，更独立，比如我们可以单独引用 reactive响应式模块，而不用引入整个 vue，这一点在 vue2 中是做不到的

整个源码都使用 TypeScript 来书写，所以能提供更好的类型推导（vue2使用flow，但是flow烂尾了）

- 语法API方面

新引入了 composition-api 可以帮助我们更好地组织代码，更方面进行逻辑复用

而且由于 composition-api 都是一个个都函数，所以能很好地配合 tree-shaking，将未引用到的模块摇除，也就是不会打包到最终代码里

- 性能方面

1. 在 vue2 中更新的粒度是组件级的，但是模版中只有少量的动态节点，其他的都是静态节点，但是更新的时候会把所有节点都进行更新，这样性能就不太好，所以在 vue3 中引入了 `Block Tree` 和 `PatchFlags`，将组件的静态节点提升，并标记动态节点，当更新时就可以做到进行`靶向更新`，大大提升了组件更新的效率

2. diff算法的优化，引入了`最长递增子序列`的算法，提升了新老节点 dom-diff 的效率